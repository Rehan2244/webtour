!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GuidedTour={})}(this,function(t){"use strict";class e{constructor(){this.isPaused=!1,this.completedSteps=[],this.completedTours=[],this.currentTour=null,this.currentStep=-1}setPaused(t){this.isPaused=t}markStepComplete(t){this.completedSteps.includes(t)||this.completedSteps.push(t)}markTourComplete(t){this.completedTours.includes(t)||this.completedTours.push(t)}isTourCompleted(t){return this.completedTours.includes(t)}reset(){this.isPaused=!1,this.completedSteps=[],this.currentStep=-1}resetAll(){this.reset(),this.completedTours=[],this.currentTour=null}}class i{constructor(){this.events={}}on(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),this}off(t,e){if(this.events[t])return this.events[t]=this.events[t].filter(t=>t!==e),this}emit(t,e){if(this.events[t])return this.events[t].forEach(i=>{try{i(e)}catch(e){console.error(`Error in event listener for ${t}:`,e)}}),this}once(t,e){const i=s=>{e(s),this.off(t,i)};return this.on(t,i)}removeAllListeners(t){return t?delete this.events[t]:this.events={},this}}class s extends i{constructor(t={}){super(),this.options={opacity:.5,color:"#000000",clickToClose:!0,zIndex:9998,...t},this.element=null,this.svgElement=null,this.currentHighlight=null}mount(){if(this.element)return;this.element=document.createElement("div"),this.element.className="guided-tour-overlay",this.element.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: ${this.options.zIndex};\n      display: none;\n      pointer-events: ${this.options.clickToClose?"auto":"none"};\n    `,this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n    ";const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","mask");e.id="guided-tour-mask";const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill","white"),e.appendChild(i),this.highlightElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.highlightElement.setAttribute("fill","black"),this.highlightElement.setAttribute("rx","4"),this.highlightElement.setAttribute("ry","4"),e.appendChild(this.highlightElement),t.appendChild(e),this.svgElement.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("fill",this.options.color),s.setAttribute("fill-opacity",this.options.opacity),s.setAttribute("mask","url(#guided-tour-mask)"),this.svgElement.appendChild(s),this.element.appendChild(this.svgElement),document.body.appendChild(this.element),this.options.clickToClose&&this.element.addEventListener("click",t=>{t.target===this.element&&this.emit("click",t)})}show(){this.element&&(this.element.style.display="block",this.element.offsetHeight,this.element.classList.add("guided-tour-overlay-visible"))}hide(){this.element&&(this.element.classList.remove("guided-tour-overlay-visible"),setTimeout(()=>{this.element.style.display="none"},300))}async highlight(t,e={}){if(!this.highlightElement)return;const{animate:i=!0,shape:s="rectangle"}=e;if(this.highlightElement.setAttribute("x",t.left),this.highlightElement.setAttribute("y",t.top),this.highlightElement.setAttribute("width",t.width),this.highlightElement.setAttribute("height",t.height),"circle"===s){const e=Math.max(t.width,t.height)/2;this.highlightElement.setAttribute("rx",e),this.highlightElement.setAttribute("ry",e)}else this.highlightElement.setAttribute("rx","8"),this.highlightElement.setAttribute("ry","8");this.highlightElement.style.transition=i?"\n        x 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),\n        y 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),\n        width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),\n        height 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),\n        rx 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94),\n        ry 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)\n      ":"none",this.currentHighlight=t,this._updatePointerEvents(t)}clearHighlight(){if(!this.highlightElement)return;this.highlightElement.setAttribute("x","-9999"),this.highlightElement.setAttribute("y","-9999"),this.highlightElement.setAttribute("width","0"),this.highlightElement.setAttribute("height","0");const t=document.querySelector(".guided-tour-click-area");t&&t.remove(),this.currentHighlight=null}_updatePointerEvents(t){const e=document.querySelector(".guided-tour-click-area");e&&e.remove();const i=document.createElement("div");i.className="guided-tour-click-area",i.style.cssText=`\n      position: fixed;\n      top: ${t.top-window.scrollY}px;\n      left: ${t.left-window.scrollX}px;\n      width: ${t.width}px;\n      height: ${t.height}px;\n      z-index: ${this.options.zIndex+1};\n      pointer-events: auto;\n    `,document.body.appendChild(i),this.once("hide",()=>{i.remove()})}destroy(){this.element&&(this.element.remove(),this.element=null,this.svgElement=null,this.highlightElement=null);const t=document.querySelector(".guided-tour-click-area");t&&t.remove(),this.removeAllListeners()}}class o extends i{constructor(t={}){super(),this.options={autoPlay:!1,showProgress:!0,showDuration:!0,showVolumeControl:!0,showPlaybackSpeed:!0,playbackSpeeds:[.5,.75,1,1.25,1.5,2],defaultVolume:.7,theme:"light",...t},this.element=null,this.audio=null,this.progressBar=null,this.playButton=null,this.volumeSlider=null,this.speedButton=null,this.currentTimeDisplay=null,this.durationDisplay=null,this.isPlaying=!1,this.currentSpeed=1,this.currentSpeedIndex=this.options.playbackSpeeds.indexOf(1)}mount(t){if(this.element)return;this.audio=document.createElement("audio"),this.audio.preload="metadata",this.audio.volume=this.options.defaultVolume,this.element=document.createElement("div"),this.element.className=`guided-tour-audio-player guided-tour-audio-player-${this.options.theme}`;const e=document.createElement("div");if(e.className="guided-tour-audio-controls",this.playButton=document.createElement("button"),this.playButton.className="guided-tour-audio-play",this.playButton.setAttribute("aria-label","Play audio"),this.playButton.innerHTML=this._getPlayIcon(),this.playButton.addEventListener("click",()=>this.togglePlay()),e.appendChild(this.playButton),this.options.showProgress||this.options.showDuration){const t=document.createElement("div");if(t.className="guided-tour-audio-progress-container",this.options.showDuration&&(this.currentTimeDisplay=document.createElement("span"),this.currentTimeDisplay.className="guided-tour-audio-time",this.currentTimeDisplay.textContent="0:00",t.appendChild(this.currentTimeDisplay)),this.options.showProgress){const e=document.createElement("div");e.className="guided-tour-audio-progress-wrapper",this.progressBar=document.createElement("input"),this.progressBar.type="range",this.progressBar.className="guided-tour-audio-progress",this.progressBar.min="0",this.progressBar.max="100",this.progressBar.value="0",this.progressBar.setAttribute("aria-label","Seek audio");const i=document.createElement("div");i.className="guided-tour-audio-progress-fill",e.appendChild(this.progressBar),e.appendChild(i),t.appendChild(e),this.progressBar.addEventListener("input",t=>{const e=t.target.value;this.seek(e),i.style.width=`${e}%`})}this.options.showDuration&&(this.durationDisplay=document.createElement("span"),this.durationDisplay.className="guided-tour-audio-time",this.durationDisplay.textContent="0:00",t.appendChild(this.durationDisplay)),e.appendChild(t)}if(this.options.showVolumeControl){const t=document.createElement("div");t.className="guided-tour-audio-volume-container";const i=document.createElement("button");i.className="guided-tour-audio-volume-button",i.setAttribute("aria-label","Toggle mute"),i.innerHTML=this._getVolumeIcon(),i.addEventListener("click",()=>this.toggleMute()),t.appendChild(i),this.volumeSlider=document.createElement("input"),this.volumeSlider.type="range",this.volumeSlider.className="guided-tour-audio-volume",this.volumeSlider.min="0",this.volumeSlider.max="100",this.volumeSlider.value=100*this.options.defaultVolume,this.volumeSlider.setAttribute("aria-label","Volume control"),this.volumeSlider.addEventListener("input",t=>{this.setVolume(t.target.value/100)}),t.appendChild(this.volumeSlider),e.appendChild(t)}this.options.showPlaybackSpeed&&(this.speedButton=document.createElement("button"),this.speedButton.className="guided-tour-audio-speed",this.speedButton.textContent="1x",this.speedButton.setAttribute("aria-label","Change playback speed"),this.speedButton.addEventListener("click",()=>this.cycleSpeed()),e.appendChild(this.speedButton)),this.element.appendChild(e),this.audio.addEventListener("loadedmetadata",()=>{this.durationDisplay&&(this.durationDisplay.textContent=this._formatTime(this.audio.duration))}),this.audio.addEventListener("timeupdate",()=>{this._updateProgress()}),this.audio.addEventListener("ended",()=>{this.isPlaying=!1,this.playButton.innerHTML=this._getPlayIcon(),this.emit("ended")}),this.audio.addEventListener("error",t=>{console.error("Audio playback error:",t),this.emit("error",t)}),t&&t.appendChild(this.element)}setSrc(t){this.audio&&(this.audio.src=t,this.audio.load(),this.options.autoPlay&&this.play())}play(){this.audio&&this.audio.src&&this.audio.play().then(()=>{this.isPlaying=!0,this.playButton.innerHTML=this._getPauseIcon(),this.emit("play")}).catch(t=>{console.error("Failed to play audio:",t),this.emit("error",t)})}pause(){this.audio&&(this.audio.pause(),this.isPlaying=!1,this.playButton.innerHTML=this._getPlayIcon(),this.emit("pause"))}togglePlay(){this.isPlaying?this.pause():this.play()}seek(t){if(!this.audio||!this.audio.duration)return;const e=t/100*this.audio.duration;this.audio.currentTime=e}setVolume(t){this.audio&&(this.audio.volume=Math.max(0,Math.min(1,t)),this.volumeSlider&&(this.volumeSlider.value=100*t))}toggleMute(){if(!this.audio)return;this.audio.muted=!this.audio.muted;const t=this.element.querySelector(".guided-tour-audio-volume-button");t&&(t.innerHTML=this.audio.muted?this._getMuteIcon():this._getVolumeIcon())}cycleSpeed(){this.currentSpeedIndex=(this.currentSpeedIndex+1)%this.options.playbackSpeeds.length,this.currentSpeed=this.options.playbackSpeeds[this.currentSpeedIndex],this.audio&&(this.audio.playbackRate=this.currentSpeed),this.speedButton&&(this.speedButton.textContent=`${this.currentSpeed}x`)}_updateProgress(){if(!this.audio||!this.audio.duration)return;const t=this.audio.currentTime/this.audio.duration*100;if(this.progressBar){this.progressBar.value=t;const e=this.element.querySelector(".guided-tour-audio-progress-fill");e&&(e.style.width=`${t}%`)}this.currentTimeDisplay&&(this.currentTimeDisplay.textContent=this._formatTime(this.audio.currentTime))}_formatTime(t){if(isNaN(t))return"0:00";return`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`}_getPlayIcon(){return'<svg viewBox="0 0 24 24" width="20" height="20">\n      <path fill="currentColor" d="M8 5v14l11-7z"/>\n    </svg>'}_getPauseIcon(){return'<svg viewBox="0 0 24 24" width="20" height="20">\n      <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>\n    </svg>'}_getVolumeIcon(){return'<svg viewBox="0 0 24 24" width="16" height="16">\n      <path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>\n    </svg>'}_getMuteIcon(){return'<svg viewBox="0 0 24 24" width="16" height="16">\n      <path fill="currentColor" d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-18-18zM12 4L9.91 6.09 12 8.18V4z"/>\n    </svg>'}destroy(){this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null),this.element&&(this.element.remove(),this.element=null),this.removeAllListeners()}}class n extends i{constructor(t={}){super(),this.options={position:"auto",maxWidth:400,offset:10,showProgress:!0,showNavigation:!0,showClose:!0,zIndex:9999,viewport:{padding:20},scrollBehavior:"reposition",...t},this.element=null,this.arrowElement=null,this.currentPosition=null,this.targetElement=null,this.scrollHandler=null,this.resizeHandler=null,this.isVisible=!1,this.audioPlayer=null}mount(){if(this.element)return;this.element=document.createElement("div"),this.element.className="guided-tour-tooltip",this.element.style.cssText=`\n      position: ${"fixed"===this.options.scrollBehavior?"fixed":"absolute"};\n      max-width: ${this.options.maxWidth}px;\n      z-index: ${this.options.zIndex};\n      display: none;\n      opacity: 0;\n    `,this.arrowElement=document.createElement("div"),this.arrowElement.className="guided-tour-tooltip-arrow",this.element.appendChild(this.arrowElement);const t=document.createElement("div");if(t.className="guided-tour-tooltip-content",this.headerElement=document.createElement("div"),this.headerElement.className="guided-tour-tooltip-header",this.titleElement=document.createElement("h3"),this.titleElement.className="guided-tour-tooltip-title",this.headerElement.appendChild(this.titleElement),this.options.showClose){const t=document.createElement("button");t.className="guided-tour-tooltip-close",t.innerHTML="×",t.setAttribute("aria-label","Close tour"),t.addEventListener("click",()=>this.emit("close")),this.headerElement.appendChild(t)}if(t.appendChild(this.headerElement),this.bodyElement=document.createElement("div"),this.bodyElement.className="guided-tour-tooltip-body",t.appendChild(this.bodyElement),this.audioContainer=document.createElement("div"),this.audioContainer.className="guided-tour-tooltip-audio",this.audioContainer.style.display="none",t.appendChild(this.audioContainer),this.footerElement=document.createElement("div"),this.footerElement.className="guided-tour-tooltip-footer",this.options.showProgress&&(this.progressElement=document.createElement("div"),this.progressElement.className="guided-tour-tooltip-progress",this.footerElement.appendChild(this.progressElement)),this.options.showNavigation){const t=document.createElement("div");t.className="guided-tour-tooltip-nav",this.prevBtn=document.createElement("button"),this.prevBtn.className="guided-tour-btn guided-tour-btn-secondary",this.prevBtn.textContent="Previous",this.prevBtn.addEventListener("click",()=>this.emit("previous")),t.appendChild(this.prevBtn),this.skipBtn=document.createElement("button"),this.skipBtn.className="guided-tour-btn guided-tour-btn-text",this.skipBtn.textContent="Skip tour",this.skipBtn.addEventListener("click",()=>this.emit("skip")),t.appendChild(this.skipBtn),this.nextBtn=document.createElement("button"),this.nextBtn.className="guided-tour-btn guided-tour-btn-primary",this.nextBtn.textContent="Next",this.nextBtn.addEventListener("click",()=>this.emit("next")),t.appendChild(this.nextBtn),this.footerElement.appendChild(t)}t.appendChild(this.footerElement),this.element.appendChild(t),document.body.appendChild(this.element),this._setupEventHandlers()}_setupEventHandlers(){let t=null,e=window.scrollY;this.scrollHandler=()=>{this.isVisible&&this.targetElement&&(t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{const i=window.scrollY,s=Math.abs(i-e);switch(this.options.scrollBehavior){case"reposition":this.element.style.transition=s<100?"top 0.2s cubic-bezier(0.4, 0, 0.2, 1), left 0.2s cubic-bezier(0.4, 0, 0.2, 1)":"none",this._updatePosition();break;case"hide":this._checkVisibility()}e=i,t=null}))},this.resizeHandler=this._debounce(()=>{this.isVisible&&this.targetElement&&this._updatePosition()},250),window.addEventListener("scroll",this.scrollHandler,!0),window.addEventListener("resize",this.resizeHandler)}setContent(t){this.element&&(this.titleElement&&(this.titleElement.textContent=t.title||""),this.bodyElement&&(this.bodyElement.innerHTML=t.content||""),t.audio?(this.audioPlayer||(this.audioPlayer=new o({autoPlay:t.audioAutoPlay||!1,showProgress:!0,showDuration:!0,showVolumeControl:!0,showPlaybackSpeed:!0,theme:t.audioTheme||"light"}),this.audioPlayer.mount(this.audioContainer),this.audioPlayer.on("play",()=>this.emit("audio-play")),this.audioPlayer.on("pause",()=>this.emit("audio-pause")),this.audioPlayer.on("ended",()=>this.emit("audio-ended")),this.audioPlayer.on("error",t=>this.emit("audio-error",t))),this.audioPlayer.setSrc(t.audio),this.audioContainer.style.display="block"):this.audioContainer&&(this.audioContainer.style.display="none",this.audioPlayer&&this.audioPlayer.pause()),this.progressElement&&t.step&&t.total&&(this.progressElement.innerHTML=`\n        <span class="guided-tour-tooltip-step">${t.step} of ${t.total}</span>\n        <div class="guided-tour-tooltip-progress-bar">\n          <div class="guided-tour-tooltip-progress-fill" style="width: ${t.step/t.total*100}%"></div>\n        </div>\n      `),this.prevBtn&&(this.prevBtn.style.display=t.showPrevious?"block":"none"),this.nextBtn&&(this.nextBtn.textContent=t.nextLabel||"Next",this.nextBtn.style.display=!1!==t.showNext?"block":"none"))}position(t,e="auto",i={}){this.element&&t&&(this.targetElement=t,this.preferredPosition=e,this.positionOptions=i,this._updatePosition())}_updatePosition(){if(!this.element||!this.targetElement)return;const{offset:t=this.options.offset,anchorPosition:e="center",viewport:i={width:window.innerWidth,height:window.innerHeight,padding:this.options.viewport.padding}}=this.positionOptions;if(!document.body.contains(this.targetElement))return void this.emit("target-removed");this.element.style.visibility="hidden",this.element.style.display="block";const s=this.targetElement.getBoundingClientRect(),o=this.element.getBoundingClientRect();if(!(s.bottom>0&&s.top<i.height&&s.right>0&&s.left<i.width)&&"hide"===this.options.scrollBehavior)return void(this.element.style.visibility="hidden");const n={top:s.top-i.padding,bottom:i.height-s.bottom-i.padding,left:s.left-i.padding,right:i.width-s.right-i.padding};let l,r,h=this.preferredPosition;if("auto"===h){const e=["bottom","top","right","left"],i={top:o.height+t,bottom:o.height+t,left:o.width+t,right:o.width+t};h=e.find(t=>n[t]>=i[t])||"bottom"}const a="fixed"===this.options.scrollBehavior;switch(h){case"top":l=s.top-o.height-t,r=this._calculateHorizontalPosition(s,o,e);break;case"bottom":l=s.bottom+t,r=this._calculateHorizontalPosition(s,o,e);break;case"left":l=this._calculateVerticalPosition(s,o,e),r=s.left-o.width-t;break;case"right":l=this._calculateVerticalPosition(s,o,e),r=s.right+t}a||(l+=window.scrollY,r+=window.scrollX);const d=i.width-o.width-i.padding+(a?0:window.scrollX),u=i.height-o.height-i.padding+(a?0:window.scrollY),c=i.padding+(a?0:window.scrollX),p=i.padding+(a?0:window.scrollY);r=Math.max(c,Math.min(r,d)),l=Math.max(p,Math.min(l,u)),a&&(l<i.padding?(h="bottom",l=s.bottom+t):l+o.height>i.height-i.padding&&(h="top",l=s.top-o.height-t)),this.element.style.position=a?"fixed":"absolute",this.element.style.top=`${l}px`,this.element.style.left=`${r}px`,this.element.style.visibility="visible",this.element.className=`guided-tour-tooltip guided-tour-tooltip-${h}`,this.currentPosition=h,this._positionArrow(s,h,{top:l,left:r})}_checkVisibility(){if(!this.targetElement)return;const t=this.targetElement.getBoundingClientRect(),e=t.bottom>0&&t.top<window.innerHeight&&t.right>0&&t.left<window.innerWidth;e?(this.element.style.visibility="visible",this.element.style.opacity="1"):(this.element.style.opacity="0",setTimeout(()=>{this.element&&!e&&(this.element.style.visibility="hidden")},300))}_calculateHorizontalPosition(t,e,i){switch(i){case"start":return t.left;case"end":return t.right-e.width;default:return t.left+(t.width-e.width)/2}}_calculateVerticalPosition(t,e,i){switch(i){case"start":return t.top;case"end":return t.bottom-e.height;default:return t.top+(t.height-e.height)/2}}_positionArrow(t,e,i){if(!this.arrowElement)return;const s=this.element.getBoundingClientRect(),o="fixed"===this.options.scrollBehavior;let n="";switch(e){case"top":case"bottom":const e=t.left+t.width/2,l=i.left-(o?0:window.scrollX);n=`left: ${Math.max(15,Math.min(e-l,s.width-15))}px;`;break;case"left":case"right":const r=t.top+t.height/2,h=i.top-(o?0:window.scrollY);n=`top: ${Math.max(15,Math.min(r-h,s.height-15))}px;`}this.arrowElement.style.cssText=n}async show(){if(this.element)return this.isVisible=!0,this.element.style.display="block",this.element.offsetHeight,this.targetElement&&this._updatePosition(),new Promise(t=>{requestAnimationFrame(()=>{this.element.style.opacity="1",this.element.classList.add("guided-tour-tooltip-visible"),setTimeout(t,300)})})}async hide(){if(this.element)return this.audioPlayer&&this.audioPlayer.pause(),this.isVisible=!1,this.element.style.opacity="0",this.element.classList.remove("guided-tour-tooltip-visible"),new Promise(t=>{setTimeout(()=>{this.element.style.display="none",this.targetElement=null,t()},300)})}_throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}_debounce(t,e){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>t.apply(this,s),e)}}destroy(){this.scrollHandler&&window.removeEventListener("scroll",this.scrollHandler,!0),this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.audioPlayer&&(this.audioPlayer.destroy(),this.audioPlayer=null),this.element&&(this.element.remove(),this.element=null,this.arrowElement=null,this.targetElement=null),this.removeAllListeners()}}class l extends i{constructor(t={}){super(),this.options={enabled:!0,position:"bottom-right",offset:20,text:"?",showBadge:!0,zIndex:9997,...t},this.element=null,this.isActive=!1}mount(){if(this.element||!this.options.enabled)return;this.element=document.createElement("button"),this.element.className="guided-tour-toggle",this.element.setAttribute("aria-label","Toggle guided tour"),this.element.style.zIndex=this.options.zIndex,this._setPosition();const t=document.createElement("span");t.className="guided-tour-toggle-content",t.textContent=this.options.text,this.element.appendChild(t),this.options.showBadge&&(this.badgeElement=document.createElement("span"),this.badgeElement.className="guided-tour-toggle-badge",this.element.appendChild(this.badgeElement)),this.element.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.emit("click")}),document.body.appendChild(this.element),setTimeout(()=>{this.element.classList.add("guided-tour-toggle-visible")},100)}_setPosition(){if(!this.element)return;const t={"top-left":{top:`${this.options.offset}px`,left:`${this.options.offset}px`,right:"auto",bottom:"auto"},"top-right":{top:`${this.options.offset}px`,right:`${this.options.offset}px`,left:"auto",bottom:"auto"},"bottom-left":{bottom:`${this.options.offset}px`,left:`${this.options.offset}px`,right:"auto",top:"auto"},"bottom-right":{bottom:`${this.options.offset}px`,right:`${this.options.offset}px`,left:"auto",top:"auto"}},e=t[this.options.position]||t["bottom-right"];Object.assign(this.element.style,e)}setActive(t){this.element&&(this.isActive=t,t?(this.element.classList.add("guided-tour-toggle-active"),this.hideBadge()):this.element.classList.remove("guided-tour-toggle-active"))}showBadge(){this.badgeElement&&(this.badgeElement.style.display="block")}hideBadge(){this.badgeElement&&(this.badgeElement.style.display="none")}show(){this.element&&(this.element.style.display="block",setTimeout(()=>{this.element.classList.add("guided-tour-toggle-visible")},10))}hide(){this.element&&(this.element.classList.remove("guided-tour-toggle-visible"),setTimeout(()=>{this.element.style.display="none"},300))}destroy(){this.element&&(this.element.classList.remove("guided-tour-toggle-visible"),setTimeout(()=>{this.element&&(this.element.remove(),this.element=null,this.badgeElement=null)},300)),this.removeAllListeners()}}class r{constructor(t={}){this.options={duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)",...t}}async fadeIn(t,e=this.options.duration){return t.style.opacity="0",t.style.display="block",t.style.transition=`opacity ${e}ms ${this.options.easing}`,t.offsetHeight,t.style.opacity="1",new Promise(t=>{setTimeout(t,e)})}async fadeOut(t,e=this.options.duration){return t.style.transition=`opacity ${e}ms ${this.options.easing}`,t.style.opacity="0",new Promise(i=>{setTimeout(()=>{t.style.display="none",i()},e)})}async slideIn(t,e="bottom",i=this.options.duration){return t.style.opacity="0",t.style.transform={top:"translateY(-30px)",bottom:"translateY(30px)",left:"translateX(-30px)",right:"translateX(30px)"}[e],t.style.display="block",t.style.transition=`all ${i}ms ${this.options.easing}`,t.offsetHeight,t.style.opacity="1",t.style.transform="translate(0)",new Promise(t=>{setTimeout(t,i)})}async slideOut(t,e="bottom",i=this.options.duration){return t.style.transition=`all ${i}ms ${this.options.easing}`,t.style.opacity="0",t.style.transform={top:"translateY(-30px)",bottom:"translateY(30px)",left:"translateX(-30px)",right:"translateX(30px)"}[e],new Promise(e=>{setTimeout(()=>{t.style.display="none",t.style.transform="",e()},i)})}async scale(t,e=.8,i=1,s=this.options.duration){return t.style.transform=`scale(${e})`,t.style.opacity="0",t.style.display="block",t.style.transition=`all ${s}ms ${this.options.easing}`,t.offsetHeight,t.style.opacity="1",t.style.transform=`scale(${i})`,new Promise(t=>{setTimeout(t,s)})}async bounce(t,e=600){return t.style.animation=`bounceIn ${e}ms ${this.options.easing}`,new Promise(i=>{setTimeout(()=>{t.style.animation="",i()},e)})}async shake(t,e=500){return t.style.animation=`shake ${e}ms`,new Promise(i=>{setTimeout(()=>{t.style.animation="",i()},e)})}async flip(t,e=600){return t.style.animation=`flip ${e}ms ${this.options.easing}`,new Promise(i=>{setTimeout(()=>{t.style.animation="",i()},e)})}pulse(t,e=2e3){t.style.animation=`pulse ${e}ms infinite`}glow(t,e=3e3){t.style.animation=`glow ${e}ms ease-in-out infinite`}float(t,e=3e3){t.style.animation=`float ${e}ms ease-in-out infinite`}stopAnimation(t){t.style.animation=""}async staggerIn(t,e=100,i="fadeIn"){const s=[];return t.forEach((t,o)=>{setTimeout(()=>{s.push(this[i](t))},o*e)}),Promise.all(s)}async scrollTo(t,e={}){const{behavior:i="smooth",block:s="center",inline:o="center",duration:n=500}=e;return t.scrollIntoView({behavior:i,block:s,inline:o}),new Promise(t=>{setTimeout(t,n)})}}class h{constructor(t={}){this.options={duration:800,easing:"easeInOutCubic",offset:0,...t},this.easings={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeOutElastic:t=>0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1,easeOutBack:t=>{const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)}}}scrollTo(t,e={}){const i={...this.options,...e};return new Promise(e=>{const s="string"==typeof t?document.querySelector(t):t;if(!s)return void e(!1);const o=s.getBoundingClientRect().top+window.scrollY,n=window.scrollY,l=o-n-i.offset,r=performance.now(),h=this.easings[i.easing]||this.easings.easeInOutCubic;if(0===i.duration)return window.scrollTo(0,o-i.offset),void e(!0);const a=t=>{const s=t-r,d=Math.min(s/i.duration,1),u=h(d);window.scrollTo(0,n+l*u),d<1?requestAnimationFrame(a):(window.scrollTo(0,o-i.offset),e(!0))};requestAnimationFrame(a)})}scrollToTop(t={}){return this.scrollTo(document.body,{...t,offset:0})}scrollToBottom(t={}){const e=document.body.scrollHeight-window.innerHeight;return new Promise(t=>{window.scrollTo({top:e,behavior:"smooth"}),setTimeout(()=>t(!0),this.options.duration)})}}class a{constructor(t={}){this.options={duration:400,overlap:.2,...t},this.activeTransitions=new Set}async transition(t,e,i){const s=Date.now();this.activeTransitions.add(s);try{const{hideFrom:t,showTo:e,beforeTransition:s,afterTransition:o}=i;s&&await s();this.options.duration,this.options.overlap;const n=this.options.duration*this.options.overlap,l=t?t():Promise.resolve(),r=new Promise(async t=>{await this.delay(n),e&&await e(),t()});await Promise.all([l,r]),o&&await o()}finally{this.activeTransitions.delete(s)}}async smoothTransition(t){const{prepare:e,execute:i,complete:s}=t;e&&await e(),await new Promise(async t=>{requestAnimationFrame(async()=>{i&&await i(),await this.delay(this.options.duration),s&&await s(),t()})})}async chainTransitions(t){for(const e of t)await this.smoothTransition(e),await this.delay(100)}async parallelTransitions(t){const e=t.map(t=>this.smoothTransition(t));await Promise.all(e)}delay(t){return new Promise(e=>setTimeout(e,t))}cubicBezier(t,e,i,s,o){const n=3*e,l=3*(s-e)-n,r=1-n-l,h=3*i,a=3*(o-i)-h,d=1-h-a,u=t=>((r*t+l)*t+n)*t;let c,p=t;for(let e=0;e<8&&(c=u(p)-t,!(Math.abs(c)<.001));e++){const t=(3*r*p+2*l)*p+n;if(Math.abs(t)<.001)break;p-=c/t}return(t=>((d*t+a)*t+h)*t)(p)}smoothStep(t,e,i,s=[.25,.46,.45,.94]){return t+(e-t)*this.cubicBezier(i,...s)}cancelAll(){this.activeTransitions.clear()}}const d={id:"default-tour",steps:[],theme:"light",animation:{enabled:!0,duration:300,easing:"ease-in-out"},overlay:{enabled:!0,opacity:.5,color:"#000000",clickToClose:!0,zIndex:9998},highlight:{padding:8,borderRadius:4,shape:"rectangle",pulse:!0},tooltip:{position:"auto",anchorPosition:"center",maxWidth:400,offset:10,showProgress:!0,showNavigation:!0,showClose:!0,zIndex:9999,viewport:{padding:20},scrollBehavior:"reposition"},audio:{enabled:!0,autoPlay:!1,showControls:!0,showProgress:!0,showDuration:!0,showVolumeControl:!0,showPlaybackSpeed:!0,playbackSpeeds:[.5,.75,1,1.25,1.5,2],defaultVolume:.7,theme:"light"},toggle:{enabled:!0,position:"bottom-right",offset:20,text:"?",showBadge:!0,zIndex:9997},keyboard:{enabled:!0,next:"ArrowRight",previous:"ArrowLeft",close:"Escape"},persistence:{enabled:!0,key:"guided-tour-state",rememberCompleted:!0},accessibility:{announceSteps:!0,focusRestore:!0,trapFocus:!0},scroll:{duration:800,easing:"easeInOutCubic",offset:0}};class u extends i{constructor(t={}){super(),this.options={...d,...t},this.state=new e,this.overlay=new s(this.options.overlay),this.tooltip=new n(this.options.tooltip),this.toggleButton=new l(this.options.toggle),this.animator=new r(this.options.animation),this.smoothScroll=new h(this.options.scroll),this.transitionManager=new a(this.options.transition),this.steps=this.options.steps||[],this.currentStepIndex=-1,this.isActive=!1,this._init()}_init(){this.overlay.mount(),this.tooltip.mount(),this.toggleButton.mount(),this._setupEventListeners(),this._applyTheme(),this.options.persistence.enabled&&this._restoreState()}_applyTheme(){const t={minimal:"guided-tour-minimal","minimal-dark":"guided-tour-minimal guided-tour-minimal-dark",dark:"guided-tour-dark",neon:"guided-tour-neon"};t[this.options.theme]&&(this.themeClass=t[this.options.theme])}_setupEventListeners(){this.toggleButton.on("click",()=>{this.isActive?this.stop():this.start()}),this.tooltip.on("next",()=>this.next()),this.tooltip.on("previous",()=>this.previous()),this.tooltip.on("skip",()=>this.skip()),this.tooltip.on("close",()=>this.stop()),this.overlay.on("click",t=>{this.options.overlay.clickToClose&&t.target===this.overlay.element&&this.stop()}),this._handleResize=this._debounce(()=>{this.isActive&&this.currentStepIndex>=0&&this._positionTooltip()},300),this._handleScroll=this._throttle(()=>{this.isActive&&this.currentStepIndex},16),window.addEventListener("resize",this._handleResize),window.addEventListener("scroll",this._handleScroll,!0)}start(){this.isActive||0===this.steps.length||(this.isActive=!0,this.currentStepIndex=0,this.themeClass&&document.body.classList.add(...this.themeClass.split(" ")),this.emit("start",{totalSteps:this.steps.length}),this.overlay.show(),this.toggleButton.setActive(!0),this._showStep(0))}stop(){this.isActive&&(this.isActive=!1,this.currentStepIndex=-1,this.themeClass&&document.body.classList.remove(...this.themeClass.split(" ")),this.emit("stop"),this.overlay.hide(),this.tooltip.hide(),this.toggleButton.setActive(!1),this._clearHighlight(),this.options.persistence.enabled&&this._saveState())}pause(){this.isActive&&(this.state.setPaused(!0),this.emit("pause",{step:this.currentStepIndex}))}resume(){this.isActive&&this.state.isPaused&&(this.state.setPaused(!1),this.emit("resume",{step:this.currentStepIndex}))}next(){!this.isActive||this.currentStepIndex>=this.steps.length-1?this.currentStepIndex===this.steps.length-1&&this.complete():(this.currentStepIndex++,this._showStep(this.currentStepIndex))}previous(){!this.isActive||this.currentStepIndex<=0||(this.currentStepIndex--,this._showStep(this.currentStepIndex))}goToStep(t){!this.isActive||t<0||t>=this.steps.length||(this.currentStepIndex=t,this._showStep(t))}skip(){this.emit("skip",{step:this.currentStepIndex}),this.stop()}complete(){this.emit("complete",{totalSteps:this.steps.length}),this.options.persistence.enabled&&this._markComplete(),this.stop()}async _showStep(t){const e=this.steps[t];if(e){console.log("Showing step:",t,e),this.emit("stepChange",{index:t,step:e,total:this.steps.length});try{this.currentStepIndex>=0&&await this.tooltip.hide(),this._clearHighlight();const i=document.querySelector(e.element);if(!i)return console.error("Element not found:",e.element),this.emit("error",{type:"element-not-found",step:t,selector:e.element}),void(t<this.steps.length-1&&setTimeout(()=>this.next(),100));await this._scrollToElement(i),await this._highlightElement(i,e),this.tooltip.setContent({title:e.title,content:e.content,step:t+1,total:this.steps.length,showPrevious:t>0,showNext:!0,nextLabel:t===this.steps.length-1?"End Tour":"Next"}),this._positionTooltip(),await this.tooltip.show()}catch(e){console.error("Error showing step:",e),this.emit("error",{type:"show-step-error",step:t,error:e.message})}}else console.error("No step found at index:",t)}async _highlightElement(t,e){const i=t.getBoundingClientRect(),s=e.padding||this.options.highlight.padding,o={top:i.top-s+window.scrollY,left:i.left-s+window.scrollX,width:i.width+2*s,height:i.height+2*s};await this.overlay.highlight(o,{animate:this.options.animation.enabled,shape:e.shape||this.options.highlight.shape}),t.classList.add("guided-tour-target"),this.options.highlight.pulse&&t.classList.add("guided-tour-pulse"),this.currentElement=t,this.currentHighlight=o}_clearHighlight(){this.currentElement&&(this.currentElement.classList.remove("guided-tour-target","guided-tour-pulse"),this.currentElement=null),this.overlay.clearHighlight()}async _scrollToElement(t){const e=t.getBoundingClientRect();if(!(e.top>=100&&e.left>=0&&e.bottom<=window.innerHeight-100&&e.right<=window.innerWidth)){e.top,window.scrollY,e.height;const i=window.innerHeight/2;await this.smoothScroll.scrollTo(t,{offset:i-e.height/2,duration:this.options.scroll?.duration||800,easing:this.options.scroll?.easing||"easeInOutCubic"}),await new Promise(t=>setTimeout(t,100))}}_positionTooltip(){if(!this.currentElement||!this.currentHighlight)return;const t=this.steps[this.currentStepIndex],e=t.position||this.options.tooltip.position,i=t.anchorPosition||this.options.tooltip.anchorPosition||"center";this.tooltip.position(this.currentElement,e,{offset:this.options.tooltip.offset,anchorPosition:i,viewport:{width:window.innerWidth,height:window.innerHeight,padding:this.options.tooltip.viewport?.padding||20}})}_saveState(){const t={completed:this.state.completedSteps,lastStep:this.currentStepIndex,timestamp:Date.now()};localStorage.setItem(this.options.persistence.key,JSON.stringify(t))}_restoreState(){try{const t=localStorage.getItem(this.options.persistence.key);if(t){const e=JSON.parse(t);this.state.completedSteps=e.completed||[]}}catch(t){console.error("Failed to restore tour state:",t)}}_markComplete(){const t=this.options.id||"default";this.state.markTourComplete(t),this._saveState()}_debounce(t,e){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t(...s)},e)}}_throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}destroy(){this.stop(),window.removeEventListener("resize",this._handleResize),window.removeEventListener("scroll",this._handleScroll,!0),this.overlay.destroy(),this.tooltip.destroy(),this.toggleButton.destroy(),this.removeAllListeners()}}t.GuidedTour=u,t.default=u,Object.defineProperty(t,"__esModule",{value:!0})});
